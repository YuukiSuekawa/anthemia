:root {
    --bg-dark: #120f0b;
    --bg-wood: #2e2319;
    --gold: #d4af37;
    --gold-shine: #f9e39e;
    --glass-bg: rgba(255, 255, 255, 0.05);
    --glass-border: rgba(255, 255, 255, 0.1);
}

body,
html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background-color: var(--bg-dark);
    font-family: 'Zen Old Mincho', serif;
    color: #f0f0f0;
}

#game-container {
    position: relative;
    width: 100%;
    height: 100%;
    background-color: #6d4c41;
    background-image:
        linear-gradient(rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.15)),
        url('Resources/bg_wood.png');
    background-size: cover;
    /* or repeat if the image was perfectly seamless, but cover is safe */
    background-blend-mode: normal;
    box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.4);
    /* Lighter vignette */
}

#game-canvas {
    display: block;
    width: 100%;
    height: 100%;
    cursor: crosshair;
}

#ui-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 30px;
    box-sizing: border-box;
}

header {
    text-align: center;
    pointer-events: auto;
    text-shadow: 0 4px 10px rgba(0, 0, 0, 0.8);
}

h1 {
    font-family: 'Cinzel', serif;
    color: var(--gold);
    margin: 0;
    font-size: 3.5rem;
    font-weight: 700;
    letter-spacing: 4px;
    background: linear-gradient(180deg, var(--gold-shine), var(--gold));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
}

.subtitle {
    color: #a89f91;
    margin-top: 5px;
    font-size: 1.2rem;
    font-style: italic;
    letter-spacing: 1px;
    opacity: 0.8;
}

#controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 25px;
    pointer-events: auto;
    margin-bottom: 30px;
}

.palette {
    display: flex;
    gap: 25px;
    background: var(--glass-bg);
    padding: 20px 40px;
    border-radius: 60px;
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
    transition: transform 0.3s;
}

.palette:hover {
    border-color: rgba(212, 175, 55, 0.5);
    box-shadow: 0 8px 32px 0 rgba(212, 175, 55, 0.1);
}

.palette {
    display: flex;
    gap: 15px;
    padding: 10px 20px;
    background: var(--glass-bg);
    border-radius: 20px;
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(8px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);

    /* Horizontal Scroll Logic */
    overflow-x: auto;
    white-space: nowrap;
    max-width: 80vw;
    /* Cap width */
    scrollbar-width: thin;
    /* Firefox */
    scrollbar-color: rgba(255, 255, 255, 0.5) rgba(255, 255, 255, 0.1);
}

.palette::-webkit-scrollbar {
    height: 6px;
    /* Horizontal scrollbar height */
    background-color: rgba(255, 255, 255, 0.1);
}

.palette::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
}

.palette::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.5);
    border-radius: 3px;
    box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.3);
}

.palette::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.8);
}

.color-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s, filter 0.2s;
    flex-shrink: 0;
    /* Prevent shrinking */

    /* Remove background color, use image instead */
    background: transparent;
    padding: 0;

    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4),
        0 0 15px rgba(255, 255, 255, 0.2);
    position: relative;
    overflow: hidden;

    /* Add subtle glow */
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
}

.color-btn img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
    pointer-events: none;
    /* Prevent image from blocking clicks */
}

.color-btn:hover {
    transform: scale(1.15);
    filter: drop-shadow(0 4px 8px rgba(255, 255, 255, 0.4)) brightness(1.1);
}

.color-btn.active {
    transform: scale(1.25);
    box-shadow: 0 0 20px var(--gold-shine),
        0 0 30px var(--gold),
        inset 0 0 15px rgba(255, 255, 255, 0.3);
    border: 3px solid var(--gold);
    filter: drop-shadow(0 6px 12px rgba(212, 175, 55, 0.6)) brightness(1.2);
    animation: gemPulse 1.5s ease-in-out infinite;
}

@keyframes gemPulse {

    0%,
    100% {
        box-shadow: 0 0 20px var(--gold-shine),
            0 0 30px var(--gold),
            inset 0 0 15px rgba(255, 255, 255, 0.3);
    }

    50% {
        box-shadow: 0 0 30px var(--gold-shine),
            0 0 40px var(--gold),
            inset 0 0 20px rgba(255, 255, 255, 0.5);
    }
}

.pot-status {
    background: var(--glass-bg);
    padding: 15px 30px;
    border-radius: 16px;
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(8px);
    text-align: center;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
}

#pot-label {
    display: block;
    margin-bottom: 8px;
    font-family: 'Cinzel', serif;
    color: var(--gold);
    font-size: 0.9rem;
    letter-spacing: 1px;
}

#pot-meter {
    width: 240px;
    height: 16px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
}

#pot-fill {
    width: 0%;
    height: 100%;
    background: #444;
    transition: width 0.5s cubic-bezier(0.22, 1, 0.36, 1), background-color 0.5s;
    box-shadow: 0 0 10px currentColor;
}

#potion-counter {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: var(--glass-bg);
    padding: 10px 20px;
    border-radius: 16px;
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(8px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
    display: flex;
    align-items: center;
    gap: 15px;
}

#potion-icon {
    width: 40px;
    height: 40px;
    object-fit: contain;
    filter: drop-shadow(0 0 5px var(--gold-shine));
}

#potion-counter .label {
    display: block;
    margin-bottom: 2px;
    font-family: 'Cinzel', serif;
    color: var(--gold);
    font-size: 0.7rem;
    letter-spacing: 1px;
    text-transform: uppercase;
}

#score-display {
    font-family: 'Zen Old Mincho', serif;
    font-size: 2.0rem;
    color: #fff;
    text-shadow: 0 0 10px var(--gold-shine);
    font-weight: 700;
    line-height: 1;
}

@media (max-width: 768px) {
    /* Mobile Layout adjustments */

    /* Move Palette to fixed position above status bars */
    .palette {
        position: fixed;
        bottom: 90px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 90%;
        justify-content: flex-start;
        /* Ensure start alignment for scrolling */
        background: rgba(255, 255, 255, 0.1);
        z-index: 101;
        /* Above other UI */
    }

    /* Move Potion Pot status to bottom-left fixed position */
    .pot-status {
        position: fixed;
        bottom: 20px;
        left: 10px;
        padding: 8px 12px;
        z-index: 100;
        transform: scale(0.9);
        transform-origin: bottom left;
    }

    /* Adjust Potion Counter to bottom-right fixed position */
    #potion-counter {
        bottom: 20px;
        right: 10px;
        padding: 5px 12px;
        gap: 5px;
        transform: scale(0.9);
        transform-origin: bottom right;
    }

    /* Smaller text/elements on mobile */
    #pot-meter {
        width: 100px;
        height: 12px;
    }

    #pot-label {
        font-size: 0.7rem;
        margin-bottom: 4px;
    }

    #potion-icon {
        width: 28px;
        height: 28px;
    }

    #score-display {
        font-size: 1.2rem;
    }
}

/* --- Title Screen --- */
#title-screen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 200;
    /* Above UI layer */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background-color: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(8px);
    transition: opacity 0.5s ease-out, visibility 0.5s;
    pointer-events: auto;
    /* Catch clicks */
}

#title-screen.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
}

#title-screen header {
    margin-bottom: 60px;
    /* Scale up slightly for title screen impact */
    transform: scale(1.2);
}

#start-prompt {
    font-family: 'Cinzel', serif;
    font-size: 2rem;
    color: #fff;
    letter-spacing: 4px;
    text-transform: uppercase;
    text-shadow: 0 0 10px var(--gold-shine);
    animation: promptBlink 2s infinite ease-in-out;
    cursor: pointer;
}

@keyframes promptBlink {

    0%,
    100% {
        opacity: 0.3;
        transform: scale(1);
    }

    50% {
        opacity: 1;
        transform: scale(1.05);
    }
}

/* Settings Button */
#settings-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid var(--gold);
    color: var(--gold);
    padding: 10px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 1000;
    pointer-events: auto;
    transition: all 0.3s ease;
    display: flex;
    justify-content: center;
    align-items: center;
}

#settings-btn:hover {
    background: var(--gold);
    color: var(--bg-dark);
    transform: rotate(90deg);
}

/* Modal Overlay */
#settings-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(5px);
    z-index: 2000;
    display: flex;
    justify-content: center;
    align-items: center;
    pointer-events: auto;
    opacity: 1;
    transition: opacity 0.3s ease;
}

#settings-modal.hidden {
    opacity: 0;
    pointer-events: none;
}

/* Modal Content */
.modal-content {
    background: rgba(20, 20, 25, 0.95);
    border: 1px solid var(--gold);
    border-radius: 15px;
    padding: 40px;
    width: 300px;
    text-align: center;
    box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.modal-content h2 {
    color: var(--gold);
    margin: 0 0 10px 0;
    font-family: 'Cinzel', serif;
}

.setting-item {
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: center;
}

.setting-item label {
    font-size: 1.1rem;
    color: #ddd;
}

/* Slider */
input[type=range] {
    -webkit-appearance: none;
    width: 100%;
    height: 6px;
    background: #444;
    border-radius: 3px;
    outline: none;
}

input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    background: var(--gold);
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.2s;
}

input[type=range]::-webkit-slider-thumb:hover {
    transform: scale(1.2);
}

/* Buttons */
#close-settings-btn {
    padding: 10px 20px;
    background: transparent;
    border: 1px solid var(--gold);
    color: var(--gold);
    border-radius: 20px;
    cursor: pointer;
    font-family: 'Cinzel', serif;
    font-size: 1rem;
    transition: all 0.2s;
    margin-top: 10px;
}

#close-settings-btn:hover {
    background: var(--gold);
    color: #000;
}

.danger-btn {
    padding: 10px 20px;
    background: rgba(255, 50, 50, 0.1);
    border: 1px solid #ff4444;
    color: #ff4444;
    border-radius: 20px;
    cursor: pointer;
    font-family: 'Cinzel', serif;
    font-size: 0.9rem;
    transition: all 0.2s;
    width: 100%;
}

.danger-btn:hover {
    background: #ff4444;
    color: #fff;
}

/* Utility */
.hidden {
    display: none !important;
}

@keyframes unlockShine {
    0% {
        transform: scale(0.5);
        opacity: 0;
        filter: brightness(1);
    }

    50% {
        transform: scale(1.5);
        opacity: 1;
        filter: brightness(2) drop-shadow(0 0 20px white);
    }

    100% {
        transform: scale(1);
        opacity: 1;
        filter: brightness(1);
    }
}

.unlock-anim {
    animation: unlockShine 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

@keyframes popIn {
    0% {
        transform: scale(0);
        opacity: 0;
    }

    70% {
        transform: scale(1.1);
        opacity: 0.9;
    }

    100% {
        transform: scale(0.9);
        opacity: 0.8;
    }
}

.pop-in {
    animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

.locked {
    filter: blur(3px) brightness(60%);
    opacity: 0.8;
    pointer-events: none;
    transform: scale(0.9);
    position: relative;
    /* Ensure text containment context if needed, though button is typically relative/inline-block */
}

.lock-count {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: 'Cinzel', serif;
    font-size: 1.2rem;
    font-weight: bold;
    color: #fff;
    text-shadow: 0 0 4px #000, 0 0 8px #000;
    pointer-events: none;
    z-index: 10;
    white-space: nowrap;
    filter: none;
    /* Prevent parent blur from affecting text if possible, but filter applies to element content. */
}

/* Note: CSS filter on parent blurs children too. 
   To fix this, we'll need to apply the blur to the IMG inside the button, separate from the text.
   So let's adjust .locked definition.
*/
.locked img {
    filter: blur(3px) brightness(60%);
}

.locked {
    /* Reset parent filter so text is sharp */
    filter: none;
    opacity: 0.8;
    pointer-events: none;
    transform: scale(0.9);
}